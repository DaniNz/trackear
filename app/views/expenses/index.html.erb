<div class="expenses-index">
  <h4 class="mt-2">Expenses</h4>
  <p class="lead mb-5">
    Welcome to expenses <%= current_user.first_name %> ðŸ™Œ<br />
    Here you will be able to keep track of all your expenses, receipts, total amounts and even invite accountants to review your activity for reports.
  </p>

  <div class="my-4 d-flex justify-content-between">
    <div>
      <div id="dateFilter"></div>
    </div>
    <div class="d-flex">
      <div class="ml-2">
        <%= render 'invite_people_button' %>
        <%= link_to new_expense_path, class: "btn btn-sm btn-primary" do %>
          <%= icon "fas", "wallet", class: "mr-1" %>
          Create expense
        <% end %>
      </div>
    </div>
  </div>

  <% if @expenses_invited_to.present? %>
    <%= form_with(url: expenses_path, model: @invitation, local: true, method: :get) do |form| %>
      <div class="form-group">
        <%= form.label :id, "Seeings expenses from" %>
        <%= form.select :id,
          @expenses_invited_to.collect { |invitation| [invitation.user.first_name, invitation.id] },
          { include_blank: "You" },
          { class: "form-control", onchange: "this.form.submit()" }
        %>
      </div>
    <% end %>
  <% end %>

  <% if @invitations.present? %>
  <small>Invitations: </small>
  <% end %>
  <% @invitations.each do |invitation| %>
  <div class="mr-2 badge badge-pill badge-secondary">
    <span data-placement="top" data-toggle="tooltip" title="Invitation <%= invitation.status %>"><%= invitation.name %></span>
    <%= link_to destroy_invitation_expenses_path(invitation), method: :delete, class: "ml-2 text-white", title: "Remove", data: { confirm: 'Are you sure?', placement: "top", toggle: "tooltip" } do %>
      <%= icon "fas", "times-circle" %>
    <% end %>
  </div>
  <% end %>

  <% if @expenses.empty? %>
  <div class="p-4 text-center">
    <p class="lead">No expenses found </p>
    <%= link_to "Create one", new_expense_path, class: "btn btn-orange" %>
  </div>
  <% else %>
    <h4>Chart</h4>
    <div id="chart" class="chart mb-4"></div>

    <h4>Details</h4>
  <% end %>

  <% @expenses.each do |expense| %>
  <div class="box mt-2 mb-3">
    <div class="row align-items-center">
      <div class="col-lg-3">
        <span class="lead text-dark">
          <%= expense.name %>
          <% if can? :manage, expense %>
            <%= link_to edit_expense_path(expense), class: "btn-block text-left btn btn-sm btn-link p-1 px-2 border-0" do %>
              <%= icon "fa", "edit" %>
              Edit
            <% end %>
          <% end %>
        </span>
      </div>

      <div class="col-lg-2">
        <% if expense.invoice.present? %>
          <%= link_to "Download invoice", download_invoice_expense_path(expense), class: "btn btn-block btn-outline-secondary btn-sm py-1" %>
        <% else %>
          <div>
            <i class="fas fa-exclamation-triangle mr-2"></i>
            No invoice attached
          </div>
        <% end %>

        <% if expense.receipt.present? %>
          <%= link_to "Download receipt", download_receipt_expense_path(expense), class: "btn btn-block btn-outline-secondary btn-sm py-1" %>
        <% else %>
          <div>
            <i class="fas fa-exclamation-triangle mr-2"></i>
            No receipt attached
          </div>
        <% end %>
      </div>

      <div class="col-lg-2">
        <% if can? :manage, expense %>
          <%= link_to "Delete", expense, method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-sm btn-outline-danger py-1" %>
        <% end %>
      </div>

      <div class="col-lg-2">
        <span class="lead text-dark">
          <%= expense.from.strftime "%d %b %Y" %>
        </span>
      </div>

      <div class="col-lg-3 text-right">
        <span class="lead text-dark">
          <%= humanized_money_with_symbol(expense.price) %>
        </span>
      </div>
    </div>
  </div>
  <% end %>

  <div class="mt-2">
    <%= will_paginate @expenses %>
  </div>

  <% if @all_expenses.present? %>
  <div class="mt-2 mr-2 lead text-dark text-right">
    Total amount in expenses for selected period: <%= humanized_money_with_symbol(calculate_total(@all_expenses)) %>
  </div>
  <% end %>

  <script>
    window.data = <%= @all_expenses.reorder(from: :asc).map{ |expense| { name: expense.from.strftime("%d %B %Y"), Spended: expense.price.to_i } }.to_json.html_safe %>
  </script>
  <%= javascript_pack_tag 'expenses/index' %>
</div>